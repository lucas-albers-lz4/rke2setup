---
- name: Prevent concurrent bootstrap/cleanup
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Check for concurrent execution
      fail:
        msg: "ERROR: Cannot run bootstrap-cluster.yml and cleanup.yml together. Please run them separately."
      when: "'cleanup.yml' in ansible_run_tags or 'cleanup.yml' in ansible_play_hosts"

- name: Bootstrap RKE2 Cluster
  hosts: three_node_cluster
  gather_facts: true
  become: true

  roles:
    - role: rke2_cluster
      vars:
        cluster_type: three_node
        first_server_ip: "{{ hostvars[groups['three_node_control_plane'][0]]['ansible_host'] }}"
