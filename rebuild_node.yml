---
- name: Rebuild RKE2 Node
  hosts: "{{ target_host | default('all') }}"
  become: true
  gather_facts: true
  serial:
    - "{{ '1' if inventory_hostname in groups['controllers'] else '2' }}"
  vars_files:
    - roles/rke2_cluster/vars/main.yml
    - roles/rke2_cluster/vars/kubectl.yml

  tasks:
    - name: Include node rebuild tasks
      ansible.builtin.include_role:
        name: rke2_cluster
        tasks_from: rebuild_node.yml
