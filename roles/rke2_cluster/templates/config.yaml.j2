write-kubeconfig-mode: '{{ rke2_config.write_kubeconfig_mode }}'
tls-san:
{% for san in rke2_config['tls-san'] %}
  - {{ san }}
{% endfor %}
node-name: {{ inventory_hostname }}
token: {{ rke2_config.token }}
{% if inventory_hostname == groups['control_plane_nodes'][0] %}
cluster-init: true
{% else %}
server: https://{{ hostvars[groups['control_plane_nodes'][0]].ansible_host }}:9345
{% endif %}
node-label:
{% if inventory_hostname in groups['control_plane_nodes'] %}
- node.kubernetes.io/instance-type=control-plane
- kubernetes.io/hostname={{ inventory_hostname }}
- workload.type=control-plane
node-taint:
- CriticalAddonsOnly=true:NoSchedule
{% else %}
- node.kubernetes.io/instance-type=worker
- kubernetes.io/hostname={{ inventory_hostname }}
- workload.type=mixed
{% endif %}
