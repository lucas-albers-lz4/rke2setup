---
# Basic configuration
token: "{{ rke2_token }}"
write-kubeconfig-mode: "0644"

{% if inventory_hostname == groups['three_node_control_plane'].0 %}
# First control plane node (init node)
cluster-init: true
{% else %}
# Additional control plane nodes
server: "https://{{ hostvars[groups['three_node_control_plane'].0]['ansible_host'] }}:9345"
{% endif %}

# TLS SANs for all control plane nodes
tls-san:
{% for host in groups['three_node_cluster'] | default([]) %}
  - {{ hostvars[host]['ansible_host'] }}
{% endfor %}

# Add node labels and remove control plane taint
node-label:
  - "node.kubernetes.io/instance-type=control-plane"
  - "kubernetes.io/hostname={{ inventory_hostname | lower }}"
  - "workload.type=mixed"

# Remove control plane taint to allow workload scheduling
node-taint:
  - "CriticalAddonsOnly=true:NoSchedule-"

# Let RKE2 use default networking settings
